<?xml version="1.0"?>

<project 
  xmlns:j="jelly:core"
  xmlns:util="jelly:util"
  xmlns:ant="jelly:ant"
  xmlns:maven="jelly:maven"
  xmlns:x="jelly:xml"
  xmlns:artifact="artifact">

  <!--==================================================================-->
  <!-- Default goal -->
  <!--==================================================================-->    
  <goal 
    name="gwt" 
    prereqs="war:webapp" 
    description="Runs GWTShell">
      <echo>compile src: ${pom.build.sourceDirectory}</echo>
      <ant:java classname="com.google.gwt.dev.GWTShell" fork="true" dir="${basedir}">
          <ant:arg value="-out"/>
          <ant:arg value="${maven.war.webapp.dir}" />
          <ant:arg value="-style" />
          <ant:arg value="${google.webtoolkit.style}" />
          <!--ant:arg value="-gen" />
          <ant:arg value="google.webtoolkit.gen" /-->
          <ant:arg value="-port" />
          <ant:arg value="${google.webtoolkit.port}" />
          <ant:arg value="-logLevel" />
          <ant:arg value="${google.webtoolkit.logLevel}" />
          <ant:arg value="${google.webtoolkit.runtarget}" />
          <ant:classpath>
                    <ant:pathelement path="${pom.build.sourceDirectory}" />
                    <ant:pathelement path="${google.webtoolkit.home}/${google.webtoolkit.dev}" />
                    <ant:pathelement path="${google.webtoolkit.home}/gwt-user.jar" />
                    <ant:path refid="maven.dependency.classpath" />
                    <ant:pathelement location="${maven.build.dest}" />
          </ant:classpath>
      </ant:java>
  </goal>
  
  <!-- -Xnoagent -Djava.compiler=NONE -Xrunjdwp:transport=dt_socket,server=y,address=8888,suspend=y -->
  <goal 
    name="gwt:debug" 
    prereqs="war:webapp" 
    description="Runs GWTShell debug">
      <ant:echo message="jvmargs=${maven.mevenide.debug.jvmargs} ${maven.mevenide.run.jvmargs}"/>
      <ant:java classname="com.google.gwt.dev.GWTShell" fork="true" dir="${basedir}">
          <ant:jvmarg line="-Xdebug -Xnoagent -Djava.compiler=NONE -Xrunjdwp:transport=dt_socket,server=y,address=8888,suspend=y"/>
          <ant:arg value="-out"/>
          <ant:arg value="${maven.war.webapp.dir}" />
          <ant:arg value="-style" />
          <ant:arg value="${google.webtoolkit.style}" />
          <!--ant:arg value="-gen" />
          <ant:arg value="google.webtoolkit.gen" /-->
          <ant:arg value="-port" />
          <ant:arg value="${google.webtoolkit.port}" />
          <ant:arg value="-logLevel" />
          <ant:arg value="${google.webtoolkit.logLevel}" />
          <ant:arg value="${google.webtoolkit.runtarget}" />
          <ant:classpath>
                    <ant:pathelement path="${google.webtoolkit.home}/${google.webtoolkit.dev}" />
                    <ant:pathelement path="${google.webtoolkit.home}/gwt-user.jar" />
                    <ant:pathelement path="${pom.build.sourceDirectory}" />
                    <ant:path refid="maven.dependency.classpath" />
                    <ant:pathelement location="${maven.build.dest}" />
          </ant:classpath>
      </ant:java>
  </goal>
  
  <goal 
    name="gwt:compile" 
    prereqs="war:webapp" 
    description="Runs GWTCompiler">
      <echo>compile src: ${pom.build.sourceDirectory}</echo>
      <ant:java classname="com.google.gwt.dev.GWTCompiler" fork="true" dir="${basedir}">
          <ant:arg value="-out"/>
          <ant:arg value="${maven.war.webapp.dir}" />
          <ant:arg value="${google.webtoolkit.compiletarget}" />
          <ant:classpath>
                    <ant:pathelement path="${google.webtoolkit.home}/${google.webtoolkit.dev}" />
                    <ant:pathelement path="${google.webtoolkit.home}/gwt-user.jar" />
                    <ant:pathelement path="${pom.build.sourceDirectory}" />
                    <ant:path refid="maven.dependency.classpath" />
                    <ant:pathelement location="${maven.build.dest}" />
          </ant:classpath>
      </ant:java>
  </goal>
    
  <goal 
    name="gwt:war" 
    prereqs="gwt:webxml, war:webapp" 
    description="Creates deployable GWT war file (including sychronizing module with web.xml)">
  </goal>  
  
  <goal 
    name="gwt:webxml"    
    description="Update web.xml target with servlet entries for GWT module service servlet definitions">
      <echo>webxml - still experimental</echo>
      <echo>module name - ${google.webtoolkit.compiletarget}</echo>
      <echo>module path - ${pom.build.sourceDirectory}/${google.webtoolkit.compiletarget}.gwt.xml (periods before .gwt.xml will be converted to File.separator)</echo>
      <echo>web.xml path - ${basedir}/${maven.war.src}/WEB-INF/web.xml</echo>
      <ant:java classname="com.totsp.mavenplugin.gwt.support.GwtWebInfProcessor" fork="true" failonerror="true" dir="${basedir}">
          <ant:arg value="-moduleName"/>
          <ant:arg value="${google.webtoolkit.compiletarget}" />
          <ant:arg value="-modulePath"/>
          <ant:arg value="${pom.build.sourceDirectory}/${google.webtoolkit.compiletarget}.gwt.xml" />
          <ant:arg value="-webXmlPath"/>
          <ant:arg value="${basedir}/${maven.war.src}/WEB-INF/web.xml" />          
          <ant:classpath>
                <ant:path refid="maven.dependency.classpath" />
                <ant:pathelement location="${plugin.getDependencyPath('com.totsp.gwt:maven-googlewebtoolkit-support')}"/>
                <ant:pathelement location="${plugin.getDependencyPath('jdom:jdom')}"/>
                <ant:pathelement location="${plugin.getDependencyPath('commons-cli:commons-cli')}"/>
          </ant:classpath>
      </ant:java>
  </goal>
  

  <!--==================================================================-->
  <!-- Initializations                                                  -->
  <!--==================================================================-->    
  <goal name="xxx:init">
    <ant:echo>hello world!</ant:echo>
  </goal>

</project>
